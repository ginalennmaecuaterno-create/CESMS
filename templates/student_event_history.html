{% extends "base_student.html" %}

{% block title %}Event History{% endblock %}

{% block content %}
<div style="min-height: 100vh; padding-bottom: 6rem;">
  <div class="container section">
    {% if events %}
    <div class="mobile-history-grid">
      {% for event in events %}
      <div class="mobile-history-card">
        <!-- Header -->
        <div class="mobile-history-header">
          <h3 class="mobile-history-title">{{ event.event_name }}</h3>
          <span class="mobile-history-badge">âœ“ Completed</span>
        </div>

        <!-- Event Details -->
        <div class="mobile-history-details">
          <div class="mobile-detail-row">
            <svg class="mobile-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            <span>{{ event.date|date_readable }}</span>
          </div>
          <div class="mobile-detail-row">
            <svg class="mobile-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span>{{ event.start_time|time_12hr }} - {{ event.end_time|time_12hr }}</span>
          </div>
          <div class="mobile-detail-row">
            <svg class="mobile-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
            <span>{{ event.location }}</span>
          </div>
          <div class="mobile-detail-row">
            <svg class="mobile-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
            </svg>
            <span>{{ event.department_name }}</span>
          </div>
          {% if not event.is_free_for_all %}
          <div class="mobile-detail-row">
            <svg class="mobile-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            {% if event.attended %}
            <span class="mobile-attendance-badge attended">âœ“ Present</span>
            {% else %}
            <span class="mobile-attendance-badge not-attended">Not Marked</span>
            {% endif %}
          </div>
          {% endif %}
        </div>

        <!-- Feedback Section -->
        {% if event.can_give_feedback %}
          {% if event.has_feedback %}
          <div class="mobile-feedback-display">
            <div class="mobile-feedback-header">
              <svg style="width: 18px; height: 18px; flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
              <span>Your Feedback</span>
            </div>
            <div class="mobile-rating-stars">
              {% for i in range(1, 6) %}
                {% if i <= event.existing_feedback.rating %}
                  <span class="star filled">â˜…</span>
                {% else %}
                  <span class="star empty">â˜…</span>
                {% endif %}
              {% endfor %}
              <span class="rating-text">({{ event.existing_feedback.rating }}/5)</span>
            </div>
            {% if event.existing_feedback.comment %}
            <p class="mobile-feedback-comment">"{{ event.existing_feedback.comment }}"</p>
            {% endif %}
            <a href="{{ url_for('feedback.submit_feedback', registration_id=event.registration_id) }}" class="mobile-action-btn btn-edit">
              <svg style="width: 14px; height: 14px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
              Edit Feedback
            </a>
          </div>
          {% else %}
          <a href="{{ url_for('feedback.submit_feedback', registration_id=event.registration_id) }}" class="mobile-action-btn btn-feedback">
            <svg style="width: 14px; height: 14px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
            </svg>
            Submit Feedback
          </a>
          {% endif %}
        {% else %}
        <div class="mobile-feedback-unavailable">
          <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span>Feedback unavailable (attendance not marked)</span>
        </div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
      <div class="empty-state-icon">ðŸ“š</div>
      <h2 class="empty-state-title">No Event History Yet</h2>
      <p class="empty-state-text">You haven't attended any completed events yet.</p>
      <a href="{{ url_for('student.view_events') }}" class="btn btn-primary" style="margin-top: 1.5rem;">
        Browse Events
      </a>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
